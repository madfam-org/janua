# Janua Production Environment Configuration
# Self-hosted on Hetzner via Enclii infrastructure
# Copy to .env.production and update with actual values

# ============================================
# CORE ENVIRONMENT
# ============================================
NODE_ENV=production
ENVIRONMENT=production
LOG_LEVEL=info
DEBUG=false

# ============================================
# DATABASE (PostgreSQL - Self-hosted with SSL)
# ============================================
DATABASE_URL=postgresql://janua:${DB_PASSWORD}@postgres:5432/janua_prod
DATABASE_POOL_SIZE=50
DATABASE_MAX_OVERFLOW=20
DATABASE_STATEMENT_TIMEOUT=30000
# SSL Configuration: disable, allow, prefer, require, verify-ca, verify-full
DATABASE_SSL_MODE=require
# For verify-ca or verify-full modes, provide the CA certificate path
DATABASE_SSL_CA_FILE=/etc/ssl/certs/db-ca.crt
# Optional: Client certificate for mutual TLS (mTLS)
# DATABASE_SSL_CERT_FILE=/etc/ssl/certs/db-client.crt
# DATABASE_SSL_KEY_FILE=/etc/ssl/private/db-client.key

# ============================================
# REDIS (Self-hosted)
# ============================================
REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379
REDIS_POOL_SIZE=20
REDIS_MAX_CONNECTIONS=100
REDIS_CONNECTION_TIMEOUT=5000

# ============================================
# API CONFIGURATION
# ============================================
# Public-facing URLs
BASE_URL=https://janua.dev
NEXT_PUBLIC_API_URL=https://api.janua.dev
NEXT_PUBLIC_APP_URL=https://app.janua.dev

# Internal container-to-container communication (Docker network)
# Used by Dashboard/Website API routes to call the API service
INTERNAL_API_URL=http://janua-api:8000

API_VERSION=v1
API_DOCS_ENABLED=false
API_MAX_REQUEST_SIZE=10485760

# ============================================
# JWT & AUTHENTICATION
# ============================================
JWT_PRIVATE_KEY=${JWT_PRIVATE_KEY}
JWT_PUBLIC_KEY=${JWT_PUBLIC_KEY}
JWT_ALGORITHM=RS256
JWT_ISSUER=https://janua.dev
JWT_AUDIENCE=janua.dev
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=15
JWT_REFRESH_TOKEN_EXPIRE_DAYS=30
JWT_REVOCATION_CHECK_ENABLED=true

# ============================================
# SECURITY
# ============================================
SECRET_KEY=${SECRET_KEY}
BCRYPT_ROUNDS=12
PASSWORD_MIN_LENGTH=8
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SPECIAL=true
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=strict
SESSION_COOKIE_DOMAIN=.janua.dev

# ============================================
# CORS
# ============================================
CORS_ORIGINS=["https://janua.dev","https://app.janua.dev","https://admin.janua.dev","https://docs.janua.dev"]
CORS_ALLOW_CREDENTIALS=true
CORS_MAX_AGE=86400

# ============================================
# RATE LIMITING
# ============================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_DEFAULT=100
RATE_LIMIT_WINDOW_SECONDS=60
RATE_LIMIT_TENANT_COMMUNITY=100
RATE_LIMIT_TENANT_PRO=1000
RATE_LIMIT_TENANT_SCALE=5000
RATE_LIMIT_TENANT_ENTERPRISE=10000

# ============================================
# EMAIL SERVICE (Resend - MADFAM Centralized)
# ============================================
EMAIL_ENABLED=true
EMAIL_PROVIDER=resend
RESEND_API_KEY=${RESEND_API_KEY}
EMAIL_FROM_ADDRESS=noreply@janua.dev
EMAIL_FROM_NAME=Janua Security
EMAIL_REPLY_TO=support@janua.dev

# ============================================
# PAYMENT PROVIDERS
# ============================================
# Conekta (Mexico)
PAYMENT_PROVIDER_MX=conekta
CONEKTA_PRIVATE_KEY=${CONEKTA_PRIVATE_KEY}
CONEKTA_PUBLIC_KEY=${CONEKTA_PUBLIC_KEY}
CONEKTA_WEBHOOK_SECRET=${CONEKTA_WEBHOOK_SECRET}
CONEKTA_SANDBOX=false

# Polar (International)
PAYMENT_PROVIDER_INTL=polar
POLAR_API_KEY=${POLAR_API_KEY}
POLAR_WEBHOOK_SECRET=${POLAR_WEBHOOK_SECRET}
POLAR_SANDBOX=false

# ============================================
# WEBAUTHN / PASSKEYS
# ============================================
WEBAUTHN_RP_ID=janua.dev
WEBAUTHN_RP_NAME=Janua
WEBAUTHN_ORIGIN=https://janua.dev
WEBAUTHN_ATTESTATION=none
WEBAUTHN_USER_VERIFICATION=preferred
WEBAUTHN_TIMEOUT=60000

# ============================================
# CLOUDFLARE SERVICES
# ============================================
# Turnstile (Bot Protection)
CLOUDFLARE_TURNSTILE_SITE_KEY=${CF_TURNSTILE_SITE_KEY}
CLOUDFLARE_TURNSTILE_SECRET=${CF_TURNSTILE_SECRET}
CLOUDFLARE_TURNSTILE_ENABLED=true

# R2 Storage (Optional - for file uploads)
CLOUDFLARE_ACCOUNT_ID=${CF_ACCOUNT_ID}
CLOUDFLARE_R2_ENDPOINT=https://${CF_ACCOUNT_ID}.r2.cloudflarestorage.com
CLOUDFLARE_R2_ACCESS_KEY=${CF_R2_ACCESS_KEY}
CLOUDFLARE_R2_SECRET_KEY=${CF_R2_SECRET_KEY}

# ============================================
# MONITORING & OBSERVABILITY
# ============================================
# Sentry
SENTRY_DSN=${SENTRY_DSN}
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.1

# Prometheus/Grafana (self-hosted via docker-compose)
PROMETHEUS_ENABLED=true
GRAFANA_PASSWORD=${GRAFANA_PASSWORD}

# ============================================
# ALERTING
# ============================================
ALERT_ENABLED=true
ALERT_SLACK_WEBHOOK=${SLACK_WEBHOOK}
ALERT_SLACK_CHANNEL=#janua-alerts
ALERT_EMAIL_TO=oncall@madfam.io

# ============================================
# WEBHOOKS
# ============================================
WEBHOOK_ENABLED=true
WEBHOOK_SIGNING_SECRET=${WEBHOOK_SECRET}
WEBHOOK_RETRY_ATTEMPTS=3
WEBHOOK_RETRY_DELAY_SECONDS=60
WEBHOOK_TIMEOUT_SECONDS=30

# ============================================
# FEATURE FLAGS (matches config.py Settings class)
# ============================================
# Note: Use ENABLE_* prefix to match config.py field names
ENABLE_DOCS=true
ENABLE_METRICS=true
ENABLE_WEBHOOKS=true
ENABLE_AUDIT=true
ENABLE_SSO=true
ENABLE_SCIM=false
ENABLE_SIGNUPS=true
ENABLE_MAGIC_LINKS=true
ENABLE_OAUTH=true
ENABLE_MFA=true
ENABLE_ORGANIZATIONS=true
# SECURITY: Keep disabled in production unless needed for testing
ENABLE_BETA_ENDPOINTS=false

# ============================================
# TENANT DEFAULTS
# ============================================
DEFAULT_TENANT_PLAN=community
DEFAULT_TENANT_TRIAL_DAYS=14
DEFAULT_MAX_MAU=2000
DEFAULT_MAX_ORGANIZATIONS=1
DEFAULT_MAX_API_CALLS_PER_MONTH=100000
DEFAULT_MAX_TEAM_MEMBERS=5
DEFAULT_DATA_RETENTION_DAYS=90

# ============================================
# INFRASTRUCTURE (Enclii/Hetzner)
# ============================================
# Enclii deployment configuration
ENCLII_SERVICE=janua
ENCLII_ENVIRONMENT=production

# Container registry (GitHub Container Registry)
CONTAINER_REGISTRY=ghcr.io/madfam-io/janua

# CDN (Cloudflare)
CDN_ENABLED=true
CDN_PROVIDER=cloudflare
CDN_BASE_URL=https://cdn.janua.dev

# ============================================
# BACKUP & DISASTER RECOVERY
# ============================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE="0 2 * * *"
BACKUP_RETENTION_DAYS=30
BACKUP_PROVIDER=r2
BACKUP_ENCRYPTION_ENABLED=true
BACKUP_ENCRYPTION_KEY=${BACKUP_KEY}

# ============================================
# COMPLIANCE & AUDIT
# ============================================
AUDIT_LOG_ENABLED=true
AUDIT_LOG_RETENTION_DAYS=2555
AUDIT_LOG_HASH_CHAIN=true
AUDIT_LOG_ENCRYPTION=true
# Compliance settings (must match config.py Settings field names)
COMPLIANCE_GDPR_ENABLED=true
COMPLIANCE_GDPR_DATA_RETENTION_DAYS=365
COMPLIANCE_GDPR_RIGHT_TO_ERASURE=true
COMPLIANCE_CCPA_ENABLED=true
COMPLIANCE_SOC2_ENABLED=true
